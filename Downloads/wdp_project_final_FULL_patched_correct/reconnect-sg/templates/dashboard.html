<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Re:Connect SG</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ request.script_root }}/static/css/styles.css">
  <link rel="stylesheet" href="{{ request.script_root }}/static/css/dashboard.css">
  <link rel="stylesheet" href="{{ request.script_root }}/static/css/tabs.css">
  <link rel="stylesheet" href="{{ request.script_root }}/static/css/messages.css">
  <link rel="stylesheet" href="{{ request.script_root }}/static/css/global_navbar.css">
</head>
<body data-logged-in="{{ '1' if session.get('user_id') else '0' }}">
<div class="global-topbar" id="reconnect-global-navbar">
  <div class="brand">Re:Connect Global</div>
  <div class="actions">
    <button type="button" id="global-notif-btn">Notifications <span class="badge" id="global-notif-badge">0</span></button>
    <button type="button" id="global-chatbot-btn">Chatbot</button>
    <button type="button" id="global-access-btn">Accessibility</button>
  </div>
  <div class="panel" id="global-notif-panel">
    <header>Notifications</header>
    <div class="panel-body" id="global-notif-list">
      <div class="item">No notifications yet.</div>
    </div>
  </div>
  <div class="panel" id="global-chatbot-panel">
    <header>FAQ Chatbot</header>
    <div class="panel-body">
      <div id="global-chatbot-log" style="max-height:160px; overflow:auto;"></div>
      <form id="global-chatbot-form" class="chatbot-input">
        <input id="global-chatbot-input" type="text" placeholder="Ask a question...">
        <button type="submit">Send</button>
      </form>
    </div>
  </div>
  <div class="panel" id="global-access-panel">
    <header>Accessibility</header>
    <div class="panel-body">
      <div class="item">Use browser zoom for text size.</div>
      <div class="item">High contrast mode: Alt + Shift + H.</div>
      <div class="item">Keyboard navigation supported.</div>
    </div>
  </div>
</div>

  <!-- Accessibility Controls -->
  <div class="accessibility-bar">
    <div class="container">
      <button id="back-btn" class="back-btn btn-auth" onclick="window.location.href='/dashboard'">â† Back to Dashboard</button>
      <div class="accessibility-controls">
        <button class="accessibility-btn btn-auth" id="font-size-btn" title="Adjust Text Size">
          <span>A</span><span style="font-size: 1.2em;">A</span>
        </button>
        <button class="accessibility-btn btn-auth" id="contrast-btn" title="Toggle High Contrast">
          â—
        </button>
        <button class="accessibility-btn btn-auth" id="lang-btn" title="Change Language">
          ğŸŒ
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Screen (fades after 1.5 seconds) -->
  <div id="welcome-screen">
    <div class="welcome-content">
        <h1 style="font-size: 3.5rem; font-family: sans-serif; margin: 0;">
            Welcome back, {{ session['user'] }}!
        </h1>
    </div>
</div>

  <!-- Main Dashboard -->
  <div id="main-dashboard" class="main-dashboard hidden">
    <!-- Top Navbar -->
    <nav class="navbar">
      <div class="container">
        <a href="index.html" class="logo">
          <div class="logo-circle"></div>
          <span class="logo-text">Re:Connect SG</span>
        </a>

        <ul class="nav-links">
          <li><a href="dashboard.html" class="active">Home</a></li>
          <li class="notification-menu">
            <button class="notification-btn btn-auth" id="notif-btn">
              <span class="notification-icon">ğŸ””</span>
              <span class="notification-badge">3</span>
            </button>
          </li>
          <li><a href="messages.html">Messages</a></li>
          <li class="profile-menu">
            <a href="profile.html" class="profile-link">
              <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah" alt="Profile" class="nav-avatar">
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Dashboard Content -->
    <main class="dashboard-main">
      <div class="container" style="max-width: 1200px;">


        <div class="dashboard-tabs">
  <div class="tabs-nav">
    <button class="tab-button active" data-tab="matches">
      <span class="tab-icon">ğŸ¤</span>
      Matches
    </button>
    <button class="tab-button" data-tab="wisdom-forum">
      <span class="tab-icon">ğŸ’¡</span>
      Wisdom Forum
    </button>
    <button class="tab-button" data-tab="challenges">
      <span class="tab-icon">ğŸ†</span>
      Weekly Challenges
    </button>
    <button class="tab-button" data-tab="badges">
      <span class="tab-icon">â­</span>
      Badges
    </button>
  </div>
</div>

        <!-- Tab Content: Matches -->
        <div class="tab-content active" id="tab-matches">
          <div class="section-header" style="margin-bottom: 2rem;">
            <h2>Your Matches</h2>
            <p>Connect with people who share your interests and goals</p>
          </div>

          <div class="matches-grid">
            <!-- Match Card 1 -->
            <div class="match-card">
              <div class="match-header">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Chen" alt="Mdm Chen" class="match-avatar">
                <div class="match-info">
                  <h3>Mdm Chen Wei Ling</h3>
                  <div class="match-meta">
                    <span class="age-badge">72 years â€¢ Elderly</span>
                  </div>
                </div>
              </div>

              <div class="match-score">
                <span class="match-percentage">95%</span>
                <span style="color: var(--muted-foreground);">match</span>
              </div>

              <div class="match-interests">
                <h4>Shared Interests</h4>
                <div class="interest-tags">
                  <span class="interest-tag">ğŸœ Cooking</span>
                  <span class="interest-tag">ğŸ“š History</span>
                  <span class="interest-tag">ğŸŒ± Gardening</span>
                </div>
              </div>

              <p class="match-bio">
                "I've been cooking traditional Peranakan dishes for over 50 years. Would love to share recipes and stories with the younger generation!"
              </p>

              <button class="say-hi-btn btn-auth">
                <span>Say Hi ğŸ‘‹</span>
              </button>
            </div>

            <!-- Match Card 2 -->
            <div class="match-card">
              <div class="match-header">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Kumar" alt="Mr Kumar" class="match-avatar">
                <div class="match-info">
                  <h3>Mr Kumar Raj</h3>
                  <div class="match-meta">
                    <span class="age-badge">68 years â€¢ Elderly</span>
                  </div>
                </div>
              </div>

              <div class="match-score">
                <span class="match-percentage">88%</span>
                <span style="color: var(--muted-foreground);">match</span>
              </div>

              <div class="match-interests">
                <h4>Shared Interests</h4>
                <div class="interest-tags">
                  <span class="interest-tag">ğŸ’» Technology</span>
                  <span class="interest-tag">ğŸµ Music</span>
                  <span class="interest-tag">ğŸ“¸ Photography</span>
                </div>
              </div>

              <p class="match-bio">
                "Retired engineer who loves learning new tech! Looking for someone to teach me Instagram and help with smartphone features."
              </p>

              <button class="say-hi-btn btn-auth">
                <span>Say Hi ğŸ‘‹</span>
              </button>
            </div>

            <!-- Match Card 3 -->
            <div class="match-card">
              <div class="match-header">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Mary" alt="Auntie Mary" class="match-avatar">
                <div class="match-info">
                  <h3>Auntie Mary Lim</h3>
                  <div class="match-meta">
                    <span class="age-badge">65 years â€¢ Elderly</span>
                  </div>
                </div>
              </div>

              <div class="match-score">
                <span class="match-percentage">92%</span>
                <span style="color: var(--muted-foreground);">match</span>
              </div>

              <div class="match-interests">
                <h4>Shared Interests</h4>
                <div class="interest-tags">
                  <span class="interest-tag">ğŸ¨ Arts & Crafts</span>
                  <span class="interest-tag">ğŸ§¶ Knitting</span>
                  <span class="interest-tag">ğŸ“– Reading</span>
                </div>
              </div>

              <p class="match-bio">
                "Love making traditional crafts and would be happy to teach! Also interested in learning about modern art trends."
              </p>

              <button class="say-hi-btn btn-auth">
                <span>Say Hi ğŸ‘‹</span>
              </button>
            </div>
          </div>
        </div>
        <!-- Tab Content: Wisdom Forum -->
      <div style="background: white; padding: 15px; border-radius: 1rem; margin-bottom: 2rem; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
    <div style="display: flex; align-items: center; gap: 12px;">
        <div style="width: 40px; height: 40px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">
            {{ session['user'][0]|upper if session['user'] else 'U' }}
        </div>
        
        <div style="display: flex; align-items: center; gap: 8px;">
            <h4 style="margin: 0; color: #1e293b;">Logged in as {{ session['user'] }}:</h4>
            <span style="color: #f59e0b; font-weight: 800; font-size: 1rem;">â­ {{ user_points }} Points</span>
        </div>
    </div>
    
    <a href="{{ url_for('logout') }}" 
       onclick="sessionStorage.removeItem('hasSeenWelcome');" 
       style="background: #fee2e2; color: #ef4444; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 0.9rem;">
        Logout
    </a>
</div>

<style>
    /* Styles for the admin action buttons */
    .admin-controls {
        display: flex; 
        justify-content: center; 
        gap: 15px; 
        padding-top: 10px; 
        border-top: 1px dashed #cbd5e1;
        margin-bottom: 10px;
    }
    
    .admin-btn-delete { color: #ef4444; background: none; border: none; cursor: pointer; font-weight: 600; }
    .admin-btn-edit { color: #3b82f6; background: none; border: none; cursor: pointer; font-weight: 600; }
</style>
        <div class="tab-content" id="tab-wisdom-forum">
  <div class="section-header" style="margin-bottom: 2rem;">
    <h2>Wisdom Forum</h2>
    <p>Explore posts and share your knowledge with the community</p>
  </div>

  <div class="wisdom-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 1.25rem; padding: 1.5rem; margin-bottom: 2rem;">
    <h3 style="margin-bottom: 1rem;">Share Your Wisdom</h3>
    <form method="post">
      <input type="text" name="title" placeholder="Topic Title" required style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid #ddd; border-radius: 0.5rem;">
      
      <select name="category" required style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid #ddd; border-radius: 0.5rem; background: white;">
        <option value="" disabled selected>Select Category</option>
        <option value="Money">ğŸ’° Money</option>
        <option value="Career">ğŸ’¼ Career</option>
        <option value="Relationships">â¤ï¸ Relationships</option>
        <option value="Life Skills">ğŸ› ï¸ Life Skills</option>
        <option value="Health">ğŸ¥ Health</option>
      </select>

      <textarea name="content" placeholder="Share your wisdom..." required style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid #ddd; border-radius: 0.5rem; height: 100px;"></textarea>
      <button type="submit" style="padding: 0.75rem 2rem; background: var(--orange); color: white; border: none; border-radius: 0.75rem; font-weight: 600; cursor: pointer;">Post to Forum</button>
    </form>
  </div>

  <div class="filter-bar" style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
    {% for cat in ['all', 'Money', 'Career', 'Relationships', 'Life Skills', 'Health'] %}
      <a href="{{ url_for('dashboard') }}?filter={{ cat }}#tab-wisdom-forum" 
         class="filter-chip {{ 'active' if selected_category == cat else '' }}"
         style="text-decoration: none; padding: 8px 16px; border-radius: 20px; border: 1px solid #ddd; color: #475569;">
        {{ cat.title() }}
      </a>
    {% endfor %}
</div>

 <div class="wisdom-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; align-items: stretch;">
    {% for post in posts %}
    <div class="wisdom-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 1.25rem; padding: 1.5rem; display: flex; flex-direction: column; height: 100%;">
      
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
          <span style="font-size: 1.5rem;">ğŸ’¡</span>
          <span style="background: #eff6ff; color: #1d4ed8; padding: 4px 12px; border-radius: 999px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; border: 1px solid #dbeafe;">
              {{ post.category }}
          </span>
      </div>

      <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem; color: #1e293b;">{{ post.title }}</h3>
      <p style="font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.75rem;">âœï¸ By: <strong>{{ post.author }}</strong></p>
      
      <p style="color: #64748b; font-size: 0.95rem; margin-bottom: 1.5rem; line-height: 1.5; flex-grow: 1;">
        {{ post.content[:100] }}{% if post.content|length > 100 %}...{% endif %}
      </p>

      <div style="margin-top: auto;">
        <div style="display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #f1f5f9; padding-top: 1rem; margin-bottom: 1rem;">
            <div style="display: flex; gap: 1rem; align-items: center;">
                <form action="{{ url_for('like_post', post_id=post.id) }}" method="post" style="display: inline;">
                    <button type="submit" style="background: #fff1f2; border: 1px solid #fecdd3; color: #e11d48; padding: 4px 10px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 4px;">
                        â¤ï¸ {{ post.likes }}
                    </button>
                </form>
                <span style="color: #94a3b8; font-size: 0.85rem;">ğŸ’¬ {{ post.comment_count }}</span>
            </div>
            <span style="color: #94a3b8; font-size: 0.75rem;">{{ post.created_at }}</span>
        </div>
        
        {% if is_admin or session['user'] == post.author %}
<div class="wisdom-controls" style="margin-top: 10px; border-top: 1px dashed #cbd5e1; padding-top: 10px; display: flex; gap: 10px; justify-content: center;">
    
    <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
    <button type="submit" 
            style="background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; padding: 4px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600;"
            onclick="return confirmDeletion()">
        ğŸ—‘ï¸ Delete
    </button>
</form>

    {% if session['user'] == post.author %}
    <button onclick="simpleEdit('{{ post.id }}', this.getAttribute('data-content'))" 
        data-content="{{ post.content | e }}"
        style="background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; padding: 4px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
    âœï¸ Edit
</button>
    {% endif %}

</div>
{% endif %}

        <a href="{{ url_for('post_detail', post_id=post.id) }}" style="display: inline-block; width: 100%; padding: 0.75rem; text-align: center; background: var(--orange); color: white; border-radius: 0.75rem; font-weight: 600; text-decoration: none;">
          View & Comment
        </a>
      </div>
    </div>
    {% endfor %} </div> ```



        
</div>


        <div id="tab-challenges" class="tab-content">
  <div class="section-header">
    <h2>Weekly Challenges</h2>
    <p>Participate in community activities and track your growth!</p>
  </div>

  {% if session['role'] == 'admin' %}
  <div class="admin-panel" style="background: #f4f4f4; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #ddd;">
    <h3>Admin Control: Post New Challenge</h3>
    <form action="/reconnect/create_challenge" method="POST">
      <div class="form-group">
        <label for="title">Challenge Title</label>
        <input type="text" name="title" id="title" placeholder="Title" required style="width: 100%; margin-bottom: 10px; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
      </div>
      <div class="form-group">
        <label for="description">Instructions</label>
        <textarea name="description" id="description" placeholder="Instructions..." required style="width: 100%; height: 80px; padding: 8px; border-radius: 4px; border: 1px solid #ccc;"></textarea>
      </div>
      <button type="submit" class="btn-primary btn-auth">Publish Challenge</button>
    </form>
  </div>
  {% endif %}
{% if session['role'] != 'admin' %}
  <div class="my-personal-submissions" style="margin-bottom: 40px; padding: 20px; background: #f0fdf4; border: 2px solid #bbf7d0; border-radius: 12px;">
    
    <h3 style="color: #166534; margin-top: 0; display: flex; align-items: center; gap: 10px;">
      ğŸ“ My Personal Submissions
    </h3>

    <div class="my-subs-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
      {% if my_submissions %}
        {% for sub in my_submissions %}
          <div class="my-sub-card" style="background: white; padding: 12px; border-radius: 8px; border: 1px solid #dcfce7; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <small style="color: #888; display: block; margin-bottom: 5px;">{{ sub.created_at }}</small>
            
            {% if sub.image_path %}
              <img src="{{ url_for('static', filename='uploads/' + sub.image_path) }}" 
                   style="width: 100%; height: 120px; object-fit: cover; border-radius: 6px; margin-bottom: 8px;">
            {% endif %}
            
            <p style="font-size: 0.9rem; margin: 0; color: #333;">{{ sub.content }}</p>
            
            <form action="{{ url_for('delete_submission', submission_id=sub.id) }}" method="POST" onsubmit="return confirm('Delete your submission?');" style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 5px;">
                <button type="submit" style="background: none; border: none; color: #ef4444; font-size: 0.75rem; cursor: pointer; padding: 0;">ğŸ—‘ï¸ Delete My Post</button>
            </form>
          </div>
        {% endfor %}
      {% else %}
        <p style="color: #666; font-style: italic;">You haven't completed any challenges yet. Check "Current Challenges" below!</p>
      {% endif %}
    </div>
  </div>
{% endif %}

<hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">

<div class="active-challenges">
  <h3>Current Challenges</h3>
  {% if challenges %}
    {% for challenge in challenges %}
      <div class="challenge-card" style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px; background: white;">
        <h4>{{ challenge.title }}</h4>
        <p>{{ challenge.description }}</p>

        {% if session['role'] == 'admin' %}
          <form action="{{ url_for('delete_challenge', challenge_id=challenge.id) }}" method="POST" onsubmit="return confirm('Delete this challenge?');" style="margin-bottom: 10px;">
              <button type="submit" style="background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; padding: 4px 12px; border-radius: 8px; cursor: pointer;">
                  ğŸ—‘ï¸ Delete Challenge
              </button>
          </form>
        {% endif %}

        {% if session['role'] != 'admin' %}
          {% if challenge.id in user_submissions %}
            <div style="background: #dcfce7; color: #15803d; padding: 10px; border-radius: 6px; font-weight: bold; border: 1px solid #bbf7d0;">
                âœ… Challenge Completed!
            </div>
          {% else %}
            <form action="/reconnect/submit_challenge/{{ challenge.id }}" method="POST" enctype="multipart/form-data" onsubmit="return validateWordCount(this)">
              <textarea name="answer" placeholder="Write your response here... (Minimum 30 words)" required 
                        oninput="updateWordCount(this)"
                        style="width: 100%; margin-bottom: 5px; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-family: inherit;"></textarea>
              
              <div style="font-size: 0.85rem; margin-bottom: 12px; color: #64748b;">
                  Words: <span class="word-count">0</span> / 30
              </div>

              <input type="file" name="file" accept="image/*" style="margin-bottom: 10px; display: block;">
              <button type="submit" class="btn-primary btn-auth">Post Submission</button>
            </form>
          {% endif %}
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p>No active challenges at the moment.</p>
  {% endif %}
</div>

<hr style="margin: 40px 0;">

<div class="submissions-gallery">
  <h3 style="margin-bottom: 20px; color: #1e293b;">Community Submissions Gallery</h3>
  <div class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
    {% if all_submissions %}
      {% for sub in all_submissions %}
        <div class="submission-card" style="border: 1px solid #e2e8f0; padding: 15px; border-radius: 12px; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
          
          <div style="background: #e0f2fe; color: #0369a1; font-size: 0.7rem; font-weight: 700; padding: 4px 10px; border-radius: 20px; display: inline-block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">
              ğŸ¯ {{ sub['challenge_name'] }}
          </div>

          <div style="margin-bottom: 8px;">
            <strong style="color: #334155;">@{{ sub['author'] }}</strong>
          </div>

          {% if sub['image_path'] %}
            <img src="{{ url_for('static', filename='uploads/' + sub['image_path']) }}" 
                 style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 12px; border: 1px solid #f1f5f9;">
          {% endif %}

          <p style="color: #475569; font-size: 0.95rem; line-height: 1.5; margin-bottom: 10px;">{{ sub['content'] }}</p>
          
          {% if session['role'] == 'admin' or session['user'] == sub['author'] %}
            <div style="border-top: 1px solid #f1f5f9; padding-top: 10px; margin-top: 10px;">
              <form action="{{ url_for('delete_submission', submission_id=sub['id']) }}" method="POST" onsubmit="return confirm('Remove this submission?');">
                  <button type="submit" style="color: #ef4444; background: #fef2f2; border: 1px solid #fee2e2; cursor: pointer; font-size: 0.75rem; padding: 5px 12px; border-radius: 6px; font-weight: 600; width: 100%;">
                      ğŸ—‘ï¸ {{ "Delete My Post" if session['user'] == sub['author'] else "Remove Submission (Admin)" }}
                  </button>
              </form>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #94a3b8; background: #f8fafc; border-radius: 12px; border: 2px dashed #e2e8f0;">
        <p>No community submissions yet. Be the first to complete a challenge!</p>
      </div>
    {% endif %}
  </div>
</div>
</div>

          

        

        <!-- Tab Content: Badges -->
        <div class="tab-content" id="tab-badges">
          <div class="section-header" style="margin-bottom: 2rem;">
            <h2>Your Badges</h2>
            <p>Earn badges by connecting, learning, and sharing</p>
          </div>

          <div style="background: white; padding: 2rem; border-radius: 1.5rem; margin-bottom: 2rem; border: 2px solid var(--border-color);">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
              <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">âœ…</div>
                <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.25rem;">First Step</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 0.5rem;">Created profile</div>
                <div style="background: var(--accent); color: var(--teal); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; display: inline-block;">UNLOCKED</div>
              </div>

              <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">ğŸ‘‹</div>
                <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.25rem;">Hello There</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 0.5rem;">Sent first message</div>
                <div style="background: var(--accent); color: var(--teal); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; display: inline-block;">UNLOCKED</div>
              </div>

              <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem; opacity: 0.3;">ğŸ“š</div>
                <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.25rem; opacity: 0.5;">Circle Starter</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 0.5rem;">Join your first Learning Circle</div>
                <div style="background: var(--muted); color: var(--muted-foreground); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; display: inline-block;">ğŸ”’ LOCKED</div>
              </div>

              <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem; opacity: 0.3;">ğŸ†</div>
                <div style="font-weight: 700; font-size: 1.25rem; margin-bottom: 0.25rem; opacity: 0.5;">Challenge Accepted</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 0.5rem;">Complete your first challenge</div>
                <div style="background: var(--muted); color: var(--muted-foreground); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; display: inline-block;">ğŸ”’ LOCKED</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
      <a href="dashboard.html" class="bottom-nav-item active">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-label">Home</span>
      </a>
      <a href="explore.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ”</span>
        <span class="nav-label">Explore</span>
      </a>
      <a href="messages.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ’¬</span>
        <span class="nav-label">Messages</span>
      </a>
      <a href="profile.html" class="bottom-nav-item">
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-label">Profile</span>
      </a>
    </nav>
  </div>

  <!-- Notifications Dropdown -->
  <div class="notifications-dropdown" id="notifications-dropdown">
    <div class="notifications-header">
      <h3>Notifications</h3>
      <button class="mark-read-btn btn-auth">Mark all as read</button>
    </div>
    <div class="notifications-list">
      <div class="notification-item unread">
        <div class="notif-icon orange">ğŸ’¬</div>
        <div class="notif-content">
          <p><strong>Mdm Chen</strong> sent you a message</p>
          <span class="notif-time">5 minutes ago</span>
        </div>
      </div>
      <div class="notification-item unread">
        <div class="notif-icon teal">ğŸ¤</div>
        <div class="notif-content">
          <p><strong>New match found!</strong> You have a 95% match with Uncle Tan</p>
          <span class="notif-time">1 hour ago</span>
        </div>
      </div>
      <div class="notification-item unread">
        <div class="notif-icon success">ğŸ†</div>
        <div class="notif-content">
          <p><strong>Badge unlocked:</strong> Hello There</p>
          <span class="notif-time">2 hours ago</span>
        </div>
      </div>
    </div>
    <a href="#" class="view-all-notif">View All Notifications</a>
  </div>

  <!-- Language Modal -->
  <div class="modal" id="lang-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Select Language / é€‰æ‹©è¯­è¨€</h3>
        <button class="close-modal" id="close-lang-modal">Ã—</button>
      </div>
      <div class="lang-options">
        <button class="lang-option-big" data-lang="en">
          <span class="lang-flag">ğŸ‡¬ğŸ‡§</span>
          <span class="lang-name">English</span>
        </button>
        <button class="lang-option-big" data-lang="zh">
          <span class="lang-flag">ğŸ‡¨ğŸ‡³</span>
          <span class="lang-name">ä¸­æ–‡ (Chinese)</span>
        </button>
        <button class="lang-option-big" data-lang="ms">
          <span class="lang-flag">ğŸ‡²ğŸ‡¾</span>
          <span class="lang-name">Bahasa Melayu</span>
        </button>
        <button class="lang-option-big" data-lang="ta">
          <span class="lang-flag">ğŸ‡®ğŸ‡³</span>
          <span class="lang-name">à®¤à®®à®¿à®´à¯ (Tamil)</span>
        </button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const welcomeScreen = document.getElementById('welcome-screen');
    const mainDashboard = document.getElementById('main-dashboard');
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    // --- 1. TAB SWITCHING FUNCTION ---
    // Defined as a function so we can call it manually for auto-loading
    function switchTab(tabName) {
      const button = document.querySelector(`[data-tab="${tabName}"]`);
      const content = document.getElementById('tab-' + tabName);
      
      if (button && content) {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        button.classList.add('active');
        content.classList.add('active');
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
    // 1. Get the hash from the URL (e.g., "#tab-challenges")
    const hash = window.location.hash;
    
    if (hash) {
        // 2. Remove the "#tab-" part to get just the tab name (e.g., "challenges")
        const tabName = hash.replace('#tab-', '');
        
        // 3. Call your existing function
        switchTab(tabName);
        
        // 4. Scroll to the tab content
        const element = document.getElementById('tab-' + tabName);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth' });
        }
    }
});

    // Attach click events to buttons
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        switchTab(button.getAttribute('data-tab'));
      });
    });

    // --- 2. WELCOME SCREEN & AUTO-LOAD LOGIC ---
const currentHash = window.location.hash;
const isReturningFromAction = currentHash === '#tab-wisdom-forum' || 
                             currentHash === '#tab-challenges' || 
                             window.location.search.includes('filter');

if (welcomeScreen) {
  // Skip animation if returning from an action or already seen welcome
  if (sessionStorage.getItem('hasSeenWelcome') || isReturningFromAction) {
    welcomeScreen.style.display = 'none';
    sessionStorage.setItem('hasSeenWelcome', 'true');
    
    if (mainDashboard) {
      mainDashboard.classList.remove('hidden');
      mainDashboard.style.opacity = '1';
    }

    // --- DYNAMIC TAB SWITCHING ---
    if (currentHash) {
      // Strips '#tab-' to get 'challenges' or 'wisdom-forum'
      const tabName = currentHash.replace('#tab-', '');
      switchTab(tabName);
    } else if (window.location.search.includes('filter')) {
      switchTab('wisdom-forum');
    }

  } else {
    // First-time login animation
    sessionStorage.setItem('hasSeenWelcome', 'true');
    if (mainDashboard) mainDashboard.classList.add('hidden');

    setTimeout(() => {
      welcomeScreen.style.opacity = '0';
      setTimeout(() => {
        welcomeScreen.style.display = 'none';
        if (mainDashboard) {
          mainDashboard.classList.remove('hidden');
          mainDashboard.style.opacity = '1';
        }
      }, 600);
    }, 1500);
  }
}

    // --- 3. SCROLL HANDLING ---
    // If we filtered, scroll to the forum so the user sees the result
    if (window.location.search.includes('filter')) {
        setTimeout(() => {
            const forumSection = document.getElementById('tab-wisdom-forum');
            if (forumSection) forumSection.scrollIntoView({ behavior: 'smooth' });
        }, 800);
    }
  });

  // --- 4. CONTENT MANAGEMENT LOGIC ---
  function confirmDeletion() {
      return confirm("Are you sure you want to delete this content?");
  }

  function simpleEdit(postId, currentContent) {
      const newText = prompt("Edit your post content:", currentContent);
      
      if (newText && newText.trim() !== "" && newText !== currentContent) {
          if (confirm("Save changes to this post?")) {
              const form = document.createElement('form');
              form.method = 'POST';
              // Append anchor to URL so we stay on the forum tab after edit
              form.action = '/edit/' + postId + '#tab-wisdom-forum';
              
              const input = document.createElement('input');
              input.type = 'hidden';
              input.name = 'content';
              input.value = newText;
              
              form.appendChild(input);
              document.body.appendChild(form);
              form.submit();
          }
      }
  }
  // Function 1: Updates the counter as the user types
function updateWordCount(textarea) {
    const text = textarea.value.trim();
    const words = text ? text.split(/\s+/).length : 0;
    const counterDisplay = textarea.parentElement.querySelector('.word-count');
    
    counterDisplay.innerText = words;
    
    // Change color: Red if under 30, Green if 30 or more
    if (words < 30) {
        counterDisplay.style.color = "#ef4444"; // Red
    } else {
        counterDisplay.style.color = "#22c55e"; // Green
    }
}

// Function 2: Stops the form from submitting if count is too low
function validateWordCount(form) {
    const text = form.querySelector('textarea[name="answer"]').value.trim();
    const words = text ? text.split(/\s+/).length : 0;

    if (words < 30) {
        alert("Your submission is too short! Please write at least 30 words. (Currently: " + words + ")");
        return false; // This "false" tells the browser NOT to send the form
    }
    return true; // This "true" allows the form to submit
}
</script>
  <script src="{{ request.script_root }}/static/js/global_navbar.js"></script>
</body>
</html>
